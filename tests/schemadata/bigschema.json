{
    "$schema": "https://json-schema.org/draft/2019-09/schema",
    "$id": "https://zowe.org/schema/app-server",
    "allOf": [
        { "$ref": "/schema/base" },
        { "type": "object",
          "properties": {
              "components": {
                  "type": "object",
                  "additionalProperties": true,
                  "properties": {
                      "app-server": {
                          "allOf": [
                              { "$ref": "/schema/base#component" },
                              { "$ref": "/schema/app-server-config"}
                          ]
                      }
                  }
              }
          }
        }
    ],
    "$defs": {
        "https://zowe.org/schema/app-server-config": {
            "$schema": "https://json-schema.org/draft/2019-09/schema",
            "$id": "https://zowe.org/schema/app-server-config",
            "title": "app-server configuration",
            "description": "Configuration properties for the app-server, as specified within a configuration file such as zowe.yaml",
            "type": "object",
            "additionalProperties": true,
            "required": [ "productDir", "siteDir", "instanceDir" ],
            "properties": {
                "node": {
                    "type": "object",
                    "description": "Configuration options specific to the app-server and things it depends upon",
                    "additionalProperties": false,
                    "properties": {
                        "https": {
                            "type": "object",
                            "additionalProperties": false,
                            "properties": {
                                "port": {
                                    "oneOf": [
                                        { "$ref": "#/$defs/tcpPort" },
                                        { "$ref": "#/$defs/reservedTcpPort" }, 
                                    ],
                                    "default": 7556
                                },
                                "pfx": {
                                    "type": "string",
                                    "deprecated": true,
                                    "description": "Replaced with use of .p12 files within the key or certificate sections, this attribute was used to load certificates from a .pfx file"
                                },
                                "keys": {
                                    "$ref": "#/$defs/certObject"
                                },
                                "certificates": {
                                    "$ref": "#/$defs/certObject"
                                },
                                "certificateAuthorities": {
                                    "$ref": "#/$defs/certObject"
                                },
                                "certificateRevocationLists": {
                                    "$ref": "#/$defs/certObject"
                                },
                                "secureOptions": {
                                    "type": "integer",
                                    "description": "Controls nodejs' use of OpenSSL via integers composed of the values in the references https://github.com/openssl/openssl/blob/master/include/openssl/ssl.h.in and https://nodejs.org/api/crypto.html#openssl-options"
                                },
                                "secureProtocol": {
                                    "type": "string",
                                    "deprecated": true,
                                    "description": "Passes through the secureProtocol attribute to TLS calls of nodeJS, as defined within https://nodejs.org/api/tls.html#tlscreatesecurecontextoptions"
                                },
                                "ciphers": {
                                    "oneOf": [
                                        { "$ref": "#/$defs/nodejsDefaultCiphers" },
                                        { "$ref": "#/$defs/zoweDefaultCiphers" },
                                        { "$ref": "#/$defs/customCiphers" }
                                    ]
                                },
                                "enableTrace": {
                                    "type": "boolean",
                                    "default": false
                                },
                                "passphrase": {
                                    "type": "string",
                                    "description": "Used to load encrypted key or certificate objects when needed"
                                },
                                "ipAddresses": {
                                    "$ref": "#/$defs/ipsAndHostnames",
                                    "default": [ "0.0.0.0" ]
                                }
                            }
                        },
                        "http": {
                            "type": "object",
                            "description": "Allows the app-server to run in HTTP mode. This should never be done without a TLS wrapper such as AT-TLS",
                            "additionalProperties": false,
                            "properties": {
                                "port": {
                                    "oneOf": [
                                        { "$ref": "#/$defs/tcpPort" },
                                        { "$ref": "#/$defs/reservedTcpPort" }, 
                                    ]
                                },
                                "ipAddresses": {
                                    "$ref": "#/$defs/ipsAndHostnames"
                                }
                            }
                        },
                        "mediationLayer": {
                            "type": "object",
                            "description": "Properties relating to how the app-server should interact with and find the API Mediation Layer components",
                            "additionalProperties": false,
                            "properties": {
                                "server": {
                                    "type": "object",
                                    "additionalProperties": false,
                                    "properties": {
                                        "isHttps": {
                                            "type": "boolean",
                                            "description": "Controls if connections to the API Mediation Layer gateway and/or discovery service should be HTTP or HTTPS"
                                        },
                                        "gatewayHostname": {
                                            "type": "string",
                                            "format": "hostname",
                                            "description": "The hostname or IP where the Zowe Gateway service is running. When not specified, the hostname property is used instead"
                                        },
                                        "hostname": {
                                            "type": "string",
                                            "format": "hostname",
                                            "description": "The hostname or IP where the Zowe Discovery service is running"
                                        },
                                        "gatewayPort": {
                                            "oneOf": [
                                                { "$ref": "#/$defs/tcpPort" },
                                                { "$ref": "#/$defs/reservedTcpPort" }, 
                                            ],
                                            "description": "The port where the Zowe Gateway service is running"
                                        },
                                        "port": {
                                            "oneOf": [
                                                { "$ref": "#/$defs/tcpPort" },
                                                { "$ref": "#/$defs/reservedTcpPort" }, 
                                            ],
                                            "description": "The port where the Zowe Discovery service is running"
                                        },
                                        "enabled": {
                                            "type": "boolean",
                                            "description": "Controls whether the app-server should register to the Zowe API Mediation Layer as a Eureka Client"
                                        },
                                        "cachingService": {
                                            "type": "object",
                                            "additionalProperties": false,
                                            "properties": {
                                                "enabled": {
                                                    "type": "boolean",
                                                    "description": "Controls whether the app-server storage API can store in the caching service"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        },
                        "internalRouting": {
                            "type": "boolean",
                            "description": "Controls if app-server should call one REST API from another by using a network call over a loopback address, or issue the request internal to the server by mimicking a network request",
                            "default": false
                        },
                        "allowInvalidTLSProxy": {
                            "type": "boolean",
                            "description": "This boolean sets the inverse value of the nodeJS attribute 'rejectUnauthorized' on any TLS operation within the server. It will allow connections with certificates that cannot be validated for one reason or another.",
                            "default": false
                        },
                        "childProcesses": {
                            "type": "array",
                            "description": "The app-server can start one or more processes as children of itself, and propagate signals sent to the app server to these. This can be used to start related servers at the same time as the app-server.",
                            "items": {
                                "type": "object",
                                "additionalProperties": false,
                                "properties": {
                                    "path": {
                                        "type": "string",
                                        "description": "The command to be started via the process spawn() command"
                                    },
                                    "once": {
                                        "type": "boolean",
                                        "description": "When true, the child process will only be started from one worker rather than per-worker as would happen in cluster mode otherwise.",
                                        "default": false
                                    }
                                }
                            }
                        },
                        "session": {
                            "type": "object",
                            "additionalProperties": false,
                            "properties": {
                                "timeoutMS": {
                                    "type": "integer",
                                    "deprecated": true,
                                    "description": "No longer read by app-server"
                                },
                                "cookie": {
                                    "timeoutMS": {
                                        "type": "integer",
                                        "description": "Determines the expiration time of the app-server cookie. This does not control other cookies such as ZSS, APIML. The experation time is shown in the /auth response, not as a cookie property. The cookie does not expire but will be rejected after the server expiration time.",
                                        "default": -1
                                    }
                                }
                            }
                        },
                        "headers": {
                            "type": "object",
                            "description": "Allows customization of http response headers sent by all plugins except those headers that are set as 'override' within a plugin. Each attribute in the object is a header name.",
                            "patternProperties": {
                                "content-security-policy": {
                                    "$ref": "#/$defs/headerCustomization",
                                    "preset": {
                                        "oneOf": [
                                            { "$ref": "#/$defs/cspPresetStrict" },
                                            { "$ref": "#/$defs/cspPresetFrameStrict" }
                                        ]
                                    }
                                },
                                "^.*$": {
                                    "$ref": "#/$defs/headerCustomization"
                                }
                            }
                        },
                        "pluginScanIntervalSec": {
                            "type": "integer",
                            "description": "When set above 0, the app-server will scan pluginsDir every number of seconds to look for plugins to add, allowing you to install new plugins without restarting the server. Note this does not allow upgrade or removal, which need restart or RBAC-controlled management REST API invocation",
                            "default": 0
                        },
                        "rootRedirectURL": {
                            "type": "string",
                            "description": "The URL which the server will redirect to if a request is sent to '/'",
                            "default": "/ZLUX/plugins/org.zowe.zlux.bootstrap/web/"
                        },
                        "noPrompt": {
                            "type": "boolean",
                            "description": "Whether to prompt for a passphrase when a passphrase is needed but not found for a pfx object",
                            "default": false
                        },
                        "noChild": {
                            "type": "boolean",
                            "default": false,
                            "description": "Whether the childProcesses array should be skipped on startup."
                        },
                        "loopbackAddress": {
                            "description": "The address the app-server should use to contact itself if a loopback request is needed by a call() operation from a plugin",
                            "$ref": "#/$defs/ipOrHostname"
                        },
                        "hostname": {
                            "type": "string",
                            "format": "hostname",
                            "description": "When not specified, the nodejs value of os.hostname() is used. This value is used to tell clients and other servers the location of the app-server."
                        }
                    }
                },
                "agent": {
                    "type": "object",
                    "description": "Configuration options specific to app-server agents, such as ZSS. These options are used to configure the agent, but also to tell app-server about the agent configuration",
                    "additionalProperties": false,
                    "properties": {
                        "host": {
                            "type": "string",
                            "description": "Tells app-server which hostname or ip to communicate with the agent at"
                        },
                        "https": {
                            "type": "object",
                            "description": "Configures the agent to use HTTPS.",
                            "additionalProperties": false,
                            "properties": {
                                "port": {
                                    "oneOf": [
                                        { "$ref": "#/$defs/tcpPort" },
                                        { "$ref": "#/$defs/reservedTcpPort" }, 
                                    ],
                                    "default": 7557
                                },
                                "ipAddresses": {
                                    "$ref": "#/$defs/ipsAndHostnames",
                                    "default": [ "0.0.0.0" ]
                                }
                            }
                        },
                        "http": {
                            "type": "object",
                            "description": "Configures the agent to use HTTP. When using AT-TLS, this object should be defined but with http.attls=true. It is insecure and absolutely not recommended to use http without AT-TLS",
                            "additionalProperties": false,
                            "properties": {
                                "port": {
                                    "oneOf": [
                                        { "$ref": "#/$defs/tcpPort" },
                                        { "$ref": "#/$defs/reservedTcpPort" }, 
                                    ]
                                },
                                "attls": {
                                    "type": "boolean",
                                    "default": false,
                                    "description": "Tells the app-server whether or not the agent should be reached using HTTPS or HTTP when contacting the HTTP port"
                                },
                                "ipAddresses": {
                                    "$ref": "#/$defs/ipsAndHostnames"
                                }
                            }
                        },
                        "mediationLayer": {
                            "type": "object",
                            "additionalProperties": false,
                            "properties": {
                                "serviceName": {
                                    "type": "string",
                                    "description": "What the agent will be named when found on the API Mediation Layer"
                                },
                                "enabled": {
                                    "type": "boolean",
                                    "description": "Controls whether the agent should register to the API Mediation Layer, and whether the app-server should contact it via the Mediation Layer"
                                }
                            }
                        },
                        "handshakeTimeout": {
                            "type": "integer",
                            "default": 30000,
                            "description": "The timeout in milliseconds on the startup check the app-server will do to find its agent and check agent capabilities"
                        },
                        "jwt": {
                            "type": "object",
                            "additionalProperties": false,
                            "properties": {
                                "fallback": {
                                    "type": "boolean",
                                    "description": "Whether the agent will issue and accept cookies from itself in the event a JWT cannot be provided"
                                }
                            }
                        }
                    }
                },
                "productDir": {
                    "type": "string",
                    "description": "The location of the product scope of the configuration dataservice",
                    "default": "{{ zowe.runtimeDirectory }}/components/app-server/share/"
                },
                "siteDir": {
                    "type": "string",
                    "description": "The location of the site scope of the configuration dataservice",
                    "default": "{{ zowe.workspaceDirectory }}/app-server/site"
                },
                "instanceDir": {
                    "type": "string",
                    "description": "The location of the instance scope of the configuration dataservice",
                    "default": "{{ zowe.workspaceDirectory }}/app-server"
                },
                "groupsDir": {
                    "type": "string",
                    "description": "The location of the groups scope of the configuration dataservice",
                    "default": "{{ zowe.workspaceDirectory }}/app-server/groups"
                },
                "usersDir": {
                    "type": "string",
                    "description": "The location of the user scope of the configuration dataservice",
                    "default": "{{ zowe.workspaceDirectory }}/app-server/users"
                },
                "pluginsDir": {
                    "type": "string",
                    "description": "The location where plugin locator JSON files are found, which are used by the app-server and agent to locate and use plugins",
                    "default": "{{ zowe.workspaceDirectory }}/app-server/plugins"
                },
                "dataserviceAuthentication": {
                    "type": "object",
                    "description": "Describes how the app-server will utilize the auth plugins it finds and loads at startup",
                    "additionalProperties": false,
                    "properties": {
                        "rbac": {
                            "type": "boolean",
                            "description": "Determines whether or not the app-server will issue authorization requests to the authentication plugins for each HTTP(S) request to achieve Role Based Access Control",
                            "default": false
                        },
                        "defaultAuthentication": {
                            "type": "string",
                            "description": "Instructs the app-server which authentication category to issue auth requests to if a specific one was not specified by the caller or plugin",
                            "default": "fallback"
                        },
                        "implementationDefaults": {
                            "type": "object",
                            "deprecated": true,
                            "patternProperties": {
                                "^.*$": {
                                    "type": "object",
                                    "additionalProperties": false,
                                    "properties": {
                                        "plugins": {
                                            "type": "array",
                                            "items": {
                                                "$ref": "#/$defs/reverseDomainNotation"
                                            },
                                            "uniqueItems": true
                                        }
                                    }
                                }
                            }
                        }
                    }
                },
                "logLevels": {
                    "type": "object",
                    "patternProperties": {
                        "_zsf.bootstrap": {
                            "description": "Logging that pertains to the startup of the server.",
                            "$ref": "#/$defs/logLevel"
                        },
                        "_zsf.auth": {
                            "description": "Logging for network calls that must be checked for authentication and authorization purposes.",
                            "$ref": "#/$defs/logLevel"
                        },
                        "_zsf.static": {
                            "description": "Logging of the serving of static files (such as images) from an application's /web folder.",
                            "$ref": "#/$defs/logLevel"
                        },
                        "_zsf.child": {
                            "description": "Logging of child processes, if any.",
                            "$ref": "#/$defs/logLevel"
                        },
                        "_zsf.utils": {
                            "description": "Logging for miscellaneous utilities that the server relies upon.",
                            "$ref": "#/$defs/logLevel"
                        },
                        "_zsf.proxy": {
                            "description": "Logging for proxies that are set up in the server.",
                            "$ref": "#/$defs/logLevel"
                        },
                        "_zsf.install": {
                            "description": "Logging for the installation of plug-ins.",
                            "$ref": "#/$defs/logLevel"
                        },
                        "_zsf.apiml": {
                            "description": "Logging for communication with the api mediation layer.",
                            "$ref": "#/$defs/logLevel"
                        },
                        "_zsf.routing": {
                            "description": "Logging for dispatching network requests to plug-in dataservices.",
                            "$ref": "#/$defs/logLevel"
                        },
                        "_zsf.network": {
                            "description": "Logging for the HTTPS server status (connection, ports, IP, and so on)",
                            "$ref": "#/$defs/logLevel"
                        },
                        "_zss.traceLevel": {
                            "description": "Controls general server logging verbosity.",
                            "$ref": "#/$defs/logLevel"
                        },
                        "_zss.fileTrace": {
                            "description": "Logs file serving behavior (if file serving is enabled).",
                            "$ref": "#/$defs/logLevel"
                        },
                        "_zss.socketTrace": {
                            "description": "Logs general TCP Socket behavior.",
                            "$ref": "#/$defs/logLevel"
                        },
                        "_zss.httpParseTrace": {
                            "description": "Logs parsing of HTTP messages.",
                            "$ref": "#/$defs/logLevel"
                        },
                        "_zss.httpDispatchTrace": {
                            "description": "Logs dispatching of HTTP messages to dataservices.",
                            "$ref": "#/$defs/logLevel"
                        },
                        "_zss.httpHeadersTrace": {
                            "description": "Logs parsing and setting of HTTP headers.",
                            "$ref": "#/$defs/logLevel"
                        },
                        "_zss.httpSocketTrace": {
                            "description": "Logs TCP socket behavior for HTTP.",
                            "$ref": "#/$defs/logLevel"
                        },
                        "_zss.httpCloseConversationTrace": {
                            "description": "Logs HTTP behavior for when an HTTP conversation ends.",
                            "$ref": "#/$defs/logLevel"
                        },
                        "_zss.httpAuthTrace": {
                            "description": "Logs behavior for session security.",
                            "$ref": "#/$defs/logLevel"
                        },
                        "_zss.mvdserver": {
                            "description": "Generic logging for ZSS items not covered by other loggers",
                            "$ref": "#/$defs/logLevel"
                        },
                        "_zss.ctds": {
                            "description": "Controls logging of the built-in CTDS service",
                            "$ref": "#/$defs/logLevel"
                        },
                        "_zss.security": {
                            "description": "Controls logging of the built-in security service",
                            "$ref": "#/$defs/logLevel"
                        },
                        "_zss.unixfile": {
                            "description": "Controls logging of the built-in unixfile service",
                            "$ref": "#/$defs/logLevel"
                        },
                        "_zss.dataservice": {
                            "description": "Controls logging of generic dataservice tasks",
                            "$ref": "#/$defs/logLevel"
                        },
                        "_zss.apimlstorage": {
                            "description": "Controls logging of the dataservice storage API",
                            "$ref": "#/$defs/logLevel"
                        },
                        "_zss.jwk": {
                            "description": "Controls logging of JWK use for SSO",
                            "$ref": "#/$defs/logLevel"
                        },
                        "^.*$": {
                            "$ref": "#/$defs/logLevel"
                        }
                    }
                },
                "logLanguage": {
                    "type": "string",
                    "default": "en"
                },
                "languages": {
                    "additionalProperties": false,
                    "properties": {
                        "java": {
                            "type": "object",
                            "additionalProperties": false,
                            "properties": {
                                "portRange": {
                                    "type": "array",
                                    "items": {
                                        "anyOf": [
                                            { "$ref": "#/$defs/tcpPort" },
                                            { "$ref": "#/$defs/reservedTcpPort" }, 
                                        ],
                                        "minItems": 2,
                                        "maxItems": 2
                                    }
                                },
                                "ports": {
                                    "type": "array",
                                    "items": {
                                        "anyOf": [
                                            { "$ref": "#/$defs/tcpPort" },
                                            { "$ref": "#/$defs/reservedTcpPort" }, 
                                        ],
                                        "uniqueItems": true
                                    }
                                },
                                "jar": {
                                    "type": "object",
                                    "properties": {
                                        "runtimes": {

                                        },
                                        "runtimeMapping": {

                                        }
                                    }
                                },
                                "war" : {
                                    "type": "object",
                                    "required": [ "javaAppServer" ],
                                    "additionalProperties": false,
                                    "properties": {
                                        "pluginGrouping": {
                                            "type": "array",
                                            "description": "A list of which java plugins should run in which java runtimes. If not present, all will run from one runtime",
                                            "items": {
                                                "type": "object",
                                                "required": [ "plugins" ],
                                                "additionalProperties": false,
                                                "properties": {
                                                    "java": {
                                                        "type": "string"
                                                    },
                                                    "plugins": {
                                                        "type": "array",
                                                        "items": {
                                                            "$ref": "#/$defs/reverseDomainNotation"
                                                        }
                                                    }
                                                }
                                            }
                                        },
                                        "defaultGrouping": {
                                            "type": "string",
                                            "description": "Determines whether services should be grouped together in as few processes as possible or run as 1 process per service",
                                            "enum": [ "microservice", "appserver" ]
                                        },
                                        "javaAppServer": {
                                            "type": "object",
                                            "propeties": {
                                                "type": {
                                                    "type": "string",
                                                    "enum": [ "tomcat" ]
                                                },
                                                "path": {
                                                    "type": "string"
                                                },
                                                "config": {
                                                    "type": "string",
                                                    "description": "The file path to the appserver config file"
                                                },
                                                "https": {
                                                    "type": "object",
                                                    "additionalProperties": false,
                                                    "properties": {
                                                        "key": {
                                                            "$ref": "#/$defs/pathCertObject"
                                                        },
                                                        "certificate": {
                                                            "$ref": "#/$defs/pathCertObject"
                                                        },
                                                        "certificateChain": {
                                                            "$ref": "#/$defs/pathCertObject"
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                },
                                "runtimes": {
                                    "type": "object",
                                    "patternProperties": {
                                        "^.*$": {
                                            "type": "object",
                                            "required": [ "home" ],
                                            "additionalProperties": false,
                                            "properties": {
                                                "home": {
                                                    "type": "string",
                                                    "description": "The path of the runtime's home directory"
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                },
                "instanceID": {
                    "type": "string",
                    "description": "The ID used in determining which set of RBAC resources to verify during authorization"
                },
                "privilegedServerName": {
                    "type": "string",
                    "description": "The nickname of the ZIS server to be used"
                }
            },
            "$defs": {
                "reverseDomainNotation": {
                    "type": "string",
                    "pattern": "^[A-Za-z]{2,6}((?!-)\\.[A-Za-z0-9-]{1,63}(?<!-))+$"
                },
                "ipv4": {
                    "type": "string",
                    "pattern": "^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$"
                },
                "ipOrHostname": {
                    "type": "string"
                },
                "ipsAndHostnames": {
                    "type": "array",
                    "items": {
                        "$ref": "#/$defs/ipOrHostname"
                    },
                    "uniqueItems": true
                },
                "nodejsDefaultCiphers": {
                    "const": "NODEJS",
                    "description": "Instructs app-server to use the default cipher list of nodejs when using TLS"
                },
                "zoweDefaultCiphers": {
                    "const": "",
                    "description": "Instructs app-server to use its default cipher list when using TLS"
                },
                "customCiphers": {
                    "type": "string",
                    "not": {
                        "anyOf": [
                            { "$ref": "#/$defs/nodejsDefaultCiphers" },
                            { "$ref": "#/$defs/zoweDefaultCiphers" }
                        ]
                    },
                    "description": "Instructs app-server to use the list of ciphers in this string when using TLS. String must be in the form defined here https://nodejs.org/api/tls.html#modifying-the-default-tls-cipher-suite"
                },
                "headerCustomization": {
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                        "substitutions": {
                            "type": "object",
                            "patternProperties": {
                                "^.*$": {
                                    "oneOf": [
                                        { "$ref": "#/$defs/headerSubstituteDomain" }
                                    ]
                                }
                            }
                        }
                    }
                },
                "headerSubstituteDomain": {
                    "const": "domain",
                    "description": "Substitute the variable referenced with the value of the domain seen on the request"
                },
                "certObject": {
                    "type": "array",
                    "description": "The location of a file or keyring object",
                    "items": {
                        "anyOf": [
                            { "$ref": "#/$defs/fileCertObject" },
                            { "$ref": "#/$defs/pathCertObject" },
                            { "$ref": "#/$defs/safKeyringCertObject" }
                        ]
                    },
                    "uniqueItems": true
                },
                "fileCertObject": {
                    "type": "string",
                    "pattern": "^file:\/\/.*$"
                },
                "safKeyringCertObject": {
                    "type": "string",
                    "pattern": "^safkeyring:(\/\/)+.*$"
                },
                "pathCertObject": {
                    "type": "string",
                    "not": {
                        "anyOf": [
                            { "pattern": "^file:\/\/.*$" },
                            { "pattern": "^safkeyring:(\/\/)+.*$" }
                        ]
                    }
                },
                "cspPresetStrict": {
                    "const": "strict",
                    "description": "Applies builtin value 'default-src self req.hostname'"
                },
                "cspPresetFrameStrict": {
                    "const": "frame-strict",
                    "description": "Applies builtin value 'frame-src self req.hostname'"
                },
                "tcpPort": {
                    "type": "integer",
                    "description": "TCP network port",
                    "minimum": 1024,
                    "maximum": 65535
                },
                "reservedTcpPort": {
                    "type": "integer",
                    "description": "Reserved TCP network ports. Can be used but discouraged due to their standardized use by common programs",
                    "deprecated": true,
                    "minimum": 1,
                    "maximum": 1023
                },
                "logLevel": {
                    "type": "integer",
                    "description": "Log level verbosity where 0 is least verbose (errors only), 5 is most verbose (trace) and 2 is default (info)",
                    "default": 2,
                    "minimum": 0,
                    "maximum": 5
                }
            }

        },
        "https://zowe.org/schema/base": {
            "$schema": "https://json-schema.org/draft/2020-12/schema",
            "$id": "https://zowe.org/schema/base",
            "title": "Zowe configuration file",
            "description": "Configuration file for Zowe (zowe.org) version 2.",
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "zowe": {
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                        "setup": {
                            "type": "object",
                            "additionalProperties": false,
                            "description": "Zowe setup configurations used by \"zwe install\" and \"zwe init\" commands.",
                            "properties": {
                                "dataset": {
                                    "type": "object",
                                    "additionalProperties": false,
                                    "description": "MVS data set related configurations",
                                    "properties": {
                                        "prefix": {
                                            "type": "string",
                                            "description": "Where Zowe MVS data sets will be installed"
                                        },
                                        "proclib": {
                                            "type": "string",
                                            "description": "PROCLIB where Zowe STCs will be copied over"
                                        },
                                        "parmlib": {
                                            "type": "string",
                                            "description": "Zowe PARMLIB"
                                        },
                                        "jcllib": {
                                            "type": "string",
                                            "description": "JCL library where Zowe will store temporary JCLs during initialization"
                                        },
                                        "authLoadlib": {
                                            "type": "string",
                                            "description": "Optional. If it's empty, <hlq>.SZWEAUTH will be APF authorized."
                                        },
                                        "authPluginLib": {
                                            "type": "string",
                                            "description": "APF authorized LOADLIB for Zowe ZIS Plugins"
                                        }
                                    }
                                },
                                "security": {
                                    "type": "object",
                                    "additionalProperties": false,
                                    "description": "Security related configurations. This setup is optional.",
                                    "properties": {
                                        "product": {
                                            "type": "string",
                                            "description": "Security product name. Can be RACF, ACF2 or TSS",
                                            "enum": ["RACF", "ACF2", "TSS"],
                                            "default": "RACF"
                                        },
                                        "groups": {
                                            "type": "object",
                                            "additionalProperties": false,
                                            "description": "security group name",
                                            "properties": {
                                                "admin": {
                                                    "type": "string",
                                                    "description": "Zowe admin user group",
                                                    "default": "ZWEADMIN"
                                                },
                                                "stc": {
                                                    "type": "string",
                                                    "description": "Zowe STC group",
                                                    "default": "ZWEADMIN"
                                                },
                                                "sysProg": {
                                                    "type": "string",
                                                    "description": "Zowe SysProg group",
                                                    "default": "ZWEADMIN"
                                                }
                                            }
                                        },
                                        "users": {
                                            "type": "object",
                                            "additionalProperties": false,
                                            "description": "security user name",
                                            "properties": {
                                                "zowe": {
                                                    "type": "string",
                                                    "description": "Zowe runtime user name of main service",
                                                    "default": "ZWESVUSR"
                                                },
                                                "zis": {
                                                    "type": "string",
                                                    "description": "Zowe runtime user name of ZIS",
                                                    "default": "ZWESIUSR"
                                                }
                                            }
                                        },
                                        "stcs": {
                                            "type": "object",
                                            "additionalProperties": false,
                                            "description": "STC names",
                                            "properties": {
                                                "zowe": {
                                                    "type": "string",
                                                    "description": "STC name of main service",
                                                    "default": "ZWESLSTC"
                                                },
                                                "zis": {
                                                    "type": "string",
                                                    "description": "STC name of ZIS",
                                                    "default": "ZWESISTC"
                                                },
                                                "aux": {
                                                    "type": "string",
                                                    "description": "STC name of Auxiliary Service",
                                                    "default": "ZWESASTC"
                                                }
                                            }
                                        }
                                    }
                                },
                                "certificate": {
                                    "type": "object",
                                    "additionalProperties": false,
                                    "if": {
                                        "properties": {
                                            "type": {
                                                "const": "PKCS12"
                                            }
                                        }
                                    },
                                    "then": {
                                        "required": ["pkcs12"]
                                    },
                                    "else": {
                                        "required": ["keyring"]
                                    },
                                    "description": "Certificate related configurations",
                                    "properties": {
                                        "type": {
                                            "type": "string",
                                            "description": "Type of certificate storage method.",
                                            "enum": ["PKCS12", "JCERACFKS"],
                                            "default": "PKCS12"
                                        },
                                        "pkcs12": {
                                            "type": "object",
                                            "additionalProperties": false,
                                            "description": "PKCS#12 keystore settings",
                                            "properties": {
                                                "directory": {
                                                    "type": "string",
                                                    "description": "Keystore directory"
                                                },
                                                "name": {
                                                    "type": "string",
                                                    "description": "Certificate alias name. Note: please use all lower cases as alias.",
                                                    "default": "localhost"
                                                },
                                                "password": {
                                                    "type": "string",
                                                    "description": "Keystore password",
                                                    "default": "password"
                                                },
                                                "caAlias": {
                                                    "type": "string",
                                                    "description": "Alias name of self-signed certificate authority. Note: please use all lower cases as alias.",
                                                    "default": "local_ca"
                                                },
                                                "caPassword": {
                                                    "type": "string",
                                                    "description": "Password of keystore stored self-signed certificate authority.",
                                                    "default": "local_ca_password"
                                                },
                                                "import": {
                                                    "type": "object",
                                                    "additionalProperties": false,
                                                    "description": "Configure this section if you want to import certificate from another PKCS#12 keystore.",
                                                    "properties": {
                                                        "keystore": {
                                                            "type": "string",
                                                            "description": "Existing PKCS#12 keystore which holds the certificate issued by external CA."
                                                        },
                                                        "password": {
                                                            "type": "string",
                                                            "description": "Password of the above keystore"
                                                        },
                                                        "alias": {
                                                            "type": "string",
                                                            "description": "Certificate alias will be imported. Note: please use all lower cases as alias."
                                                        }
                                                    }
                                                }
                                            }
                                        },
                                        "keyring": {
                                            "type": "object",
                                            "additionalProperties": false,
                                            "description": "Configure this section if you are using z/OS JCERACFKS keyring",
                                            "properties": {
                                                "name": {
                                                    "type": "string",
                                                    "description": "keyring name"
                                                },
                                                "label": {
                                                    "type": "string",
                                                    "description": "Label of Zowe certificate.",
                                                    "default": "localhost"
                                                },
                                                "caLabel": {
                                                    "type": "string",
                                                    "description": "label of Zowe CA certificate.",
                                                    "default": "localca"
                                                },
                                                "connect": {
                                                    "type": "object",
                                                    "additionalProperties": false,
                                                    "description": "Configure this section if you want to connect existing certificate in keyring to Zowe.",
                                                    "properties": {
                                                        "user": {
                                                            "type": "string",
                                                            "description": "Current owner of the existing certificate, can be SITE or an user ID."
                                                        },
                                                        "label": {
                                                            "type": "string",
                                                            "description": "Label of the existing certificate will be connected to Zowe keyring."
                                                        }
                                                    }
                                                },
                                                "import": {
                                                    "type": "object",
                                                    "additionalProperties": false,
                                                    "description": "Configure this section if you want to import existing certificate stored in data set to Zowe.",
                                                    "properties": {
                                                        "dsName": {
                                                            "type": "string",
                                                            "description": "Name of the data set holds the certificate issued by other CA. This data set should be in PKCS12 format and contain private key."
                                                        },
                                                        "password": {
                                                            "type": "string",
                                                            "description": "Password for the PKCS12 data set."
                                                        }
                                                    }
                                                }
                                            }
                                        },
                                        "dname": {
                                            "type": "object",
                                            "additionalProperties": false,
                                            "description": "Certificate distinguish name",
                                            "properties": {
                                                "caCommonName": {
                                                    "type": "string",
                                                    "description": "Common name of certificate authority generated by Zowe."
                                                },
                                                "commonName": {
                                                    "type": "string",
                                                    "description": "Common name of certificate generated by Zowe."
                                                },
                                                "orgUnit": {
                                                    "type": "string",
                                                    "description": "Organization unit of certificate generated by Zowe."
                                                },
                                                "org": {
                                                    "type": "string",
                                                    "description": "Organization of certificate generated by Zowe."
                                                },
                                                "locality": {
                                                    "type": "string",
                                                    "description": "Locality of certificate generated by Zowe. This is usually the city name."
                                                },
                                                "state": {
                                                    "type": "string",
                                                    "description": "State of certificate generated by Zowe. You can also put province name here."
                                                },
                                                "country": {
                                                    "type": "string",
                                                    "description": "2 letters country code of certificate generated by Zowe."
                                                }
                                            }
                                        },
                                        "validity": {
                                            "type": "integer",
                                            "description": "Validity days for Zowe generated certificates",
                                            "default": 3650
                                        },
                                        "san": {
                                            "type": "array",
                                            "description": "Domain names and IPs should be added into certificate SAN. If this field is not defined, `zwe init` command will use `zowe.externalDomains`.",
                                            "items": {
                                                "type": "string"
                                            }
                                        },
                                        "importCertificateAuthorities": {
                                            "type": "array",
                                            "description": "PEM format certificate authorities will also be imported and trusted. If you have other certificate authorities want to be trusted in Zowe keyring, list the certificate labels here. **NOTE**, due to the limitation of RACDCERT command, this field should contain maximum 2 entries.",
                                            "items": {
                                                "type": "string"
                                            }
                                        }
                                    }
                                },
                                "vsam": {
                                    "type": "object",
                                    "additionalProperties": false,
                                    "description": "VSAM configurations if you are using VSAM as Caching Service storage",
                                    "properties": {
                                        "mode": {
                                            "type": "string",
                                            "description": "VSAM data set with Record-Level-Sharing enabled or not",
                                            "enum": ["NONRLS", "RLS"],
                                            "default": "NONRLS"
                                        },
                                        "volume": {
                                            "type": "string",
                                            "description": "Volume name if you are using VSAM in NONRLS mode"
                                        },
                                        "storageClass": {
                                            "type": "string",
                                            "description": "Storage class name if you are using VSAM in RLS mode"
                                        }
                                    }
                                }
                            }
                        },
                        "runtimeDirectory": {
                            "type": "string",
                            "description": "Path to where you installed Zowe."
                        },
                        "logDirectory": {
                            "type": "string",
                            "description": "Path to where you want to store Zowe log files."
                        },
                        "workspaceDirectory": {
                            "type": "string",
                            "description": "Path to where you want to store Zowe workspace files. Zowe workspace are used by Zowe component runtime to store temporary files."
                        },
                        "extensionDirectory": {
                            "type": "string",
                            "description": "Path to where you want to store Zowe extensions. \"zwe components install\" will install new extensions into this directory."
                        },
                        "job": {
                            "type": "object",
                            "additionalProperties": false,
                            "description": "Customize your Zowe z/OS JES job.",
                            "properties": {
                                "name": {
                                    "type": "string",
                                    "description": "Job name of Zowe primary ZWESLSTC started task."
                                },
                                "prefix": {
                                    "type": "string",
                                    "description": "A short prefix to customize address spaces created by Zowe job."
                                }
                            }
                        },
                        "externalDomains": {
                            "type": "array",
                            "description": "List of domain names of how you access Zowe from your local computer.",
                            "minItems": 1,
                            "uniqueItems": true,
                            "items": {
                                "type": ["string"]
                            }
                        },
                        "externalPort": {
                            "$ref": "#/$defs/port",
                            "description": "Port number of how you access Zowe APIML Gateway from your local computer."
                        },
                        "environments": {
                            "type": "object",
                            "description": "Global environment variables can be applied to all Zowe high availability instances."
                        },
                        "launchScript": {
                            "type": "object",
                            "description": "Customize Zowe launch scripts (zwe commands) behavior.",
                            "properties": {
                                "logLevel": {
                                    "type": "string",
                                    "description": "Log level for Zowe launch scripts.",
                                    "enum": ["", "info", "debug", "trace"]
                                }
                            }
                        },
                        "certificate": {
                            "$ref": "#/$defs/certificate",
                            "description": "Zowe certificate setup."
                        },
                        "verifyCertificates": {
                            "type": "string",
                            "description": "Customize how Zowe should validate certificates used by components or other services.",
                            "enum": ["STRICT", "NONSTRICT", "DISABLED"]
                        }
                    }
                },
                "java": {
                    "type": "object",
                    "properties": {
                        "home": {
                            "type": "string",
                            "description": "Path to Java home directory."
                        }
                    }
                },
                "node": {
                    "type": "object",
                    "properties": {
                        "home": {
                            "type": "string",
                            "description": "Path to node.js home directory."
                        }
                    }
                },
                "zOSMF": {
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                        "host": {
                            "type": "string",
                            "description": "Host or domain name of your z/OSMF instance."
                        },
                        "port": {
                            "$ref": "#/$defs/port",
                            "description": "Port number of your z/OSMF instance."
                        },
                        "applId": {
                            "type": "string",
                            "description": "Appl ID of your z/OSMF instance."
                        }
                    }
                },
                "components": {
                    "type": "object",
                    "patternProperties": {
                        "^.*$": {
                            "$ref": "#/$defs/component"
                        }
                    }
                },
                "haInstances": {
                    "type": "object",
                    "patternProperties": {
                        "^.*$": {
                            "type": "object",
                            "description": "Configuration of Zowe high availability instance.",
                            "properties": {
                                "hostname": {
                                    "type": "string",
                                    "description": "Host name of the Zowe high availability instance. This is hostname for internal communications."
                                },
                                "sysname": {
                                    "type": "string",
                                    "description": "z/OS system name of the Zowe high availability instance. Some JES command will be routed to this system name."
                                },
                                "components": {
                                    "type": "object",
                                    "patternProperties": {
                                        "^.*$": {
                                            "$ref": "#/$defs/component"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            },
            "$defs": {
                "port": {
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 65535
                },
                "certificate": {
                    "type": "object",
                    "additionalProperties": false,
                    "required": ["keystore", "truststore", "pem"],
                    "properties": {
                        "keystore": {
                            "type": "object",
                            "additionalProperties": false,
                            "description": "Certificate keystore.",
                            "required": ["type", "file", "alias"],
                            "properties": {
                                "type": {
                                    "type": "string",
                                    "description": "Keystore type.",
                                    "enum": ["PKCS12", "JCERACFKS"]
                                },
                                "file": {
                                    "type": "string",
                                    "description": "Path to your PKCS#12 keystore or z/OS JCERACFKS keyring."
                                },
                                "password": {
                                    "type": "string",
                                    "description": "Password of your PKCS#12 keystore."
                                },
                                "alias": {
                                    "type": "string",
                                    "description": "Certificate alias name of defined in your PKCS#12 keystore, or certificate label of z/OS JCERACFKS keyring."
                                }
                            }
                        },
                        "truststore": {
                            "type": "object",
                            "additionalProperties": false,
                            "description": "Certificate truststore.",
                            "required": ["type", "file"],
                            "properties": {
                                "type": {
                                    "type": "string",
                                    "description": "Truststore type.",
                                    "enum": ["PKCS12", "JCERACFKS"]
                                },
                                "file": {
                                    "type": "string",
                                    "description": "Path to your PKCS#12 keystore or z/OS JCERACFKS keyring."
                                },
                                "password": {
                                    "type": "string",
                                    "description": "Password of your PKCS#12 keystore."
                                }
                            }
                        },
                        "pem": {
                            "type": "object",
                            "additionalProperties": false,
                            "description": "Certificate in PEM format.",
                            "required": ["key", "certificate"],
                            "properties": {
                                "key": {
                                    "type": "string",
                                    "description": "Path to the certificate private key stored in PEM format."
                                },
                                "certificate": {
                                    "type": "string",
                                    "description": "Path to the certificate stored in PEM format."
                                },
                                "certificateAuthorities": {
                                    "description": "List of paths to the certificate authorities stored in PEM format.",
                                    "oneOf": [{
                                        "type": "string",
                                        "description": "Paths to the certificate authorities stored in PEM format. You can separate multiple certificate authorities by comma."
                                    },
                                              {
                                                  "type": "array",
                                                  "description": "Path to the certificate authority stored in PEM format.",
                                                  "items": {
                                                      "type": "string"
                                                  }
                                              }
                                             ]
                                }
                            }
                        }
                    }
                },
                "component": {
                    "type": "object",
                    "$anchor": "component",
                    "required": [ "enabled" ],
                    "properties": {
                        "enabled": {
                            "type": "boolean",
                            "description": "Whether to enable or disable this component",
                            "default": false
                        },
                        "certificate": {
                            "$ref": "#/$defs/certificate",
                            "description": "Certificate for current component."
                        }
                    }
                }
            }
        }
    }
}
